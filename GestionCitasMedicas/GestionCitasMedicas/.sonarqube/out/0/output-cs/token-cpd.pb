Â
NC:\Users\nahir\source\repos\GestionCitasMedicas\GestionCitasMedicas\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
string		  
GetEncryptedUsername		 
(		 
)		 
=>		  
$str		! %
;		% &
string

  
GetEncryptedPassword

 
(

 
)

 
=>

  
Environment

! ,
.

, -"
GetEnvironmentVariable

- C
(

C D
$str

D Q
)

Q R
??

S U
$str

V a
;

a b
string 
username 
=  
GetEncryptedUsername &
(& '
)' (
;( )
string 
password 
=  
GetEncryptedPassword &
(& '
)' (
;( )
string 
server 
= 
$str #
;# $
string 
database 
= 
$str $
;$ %
string 
connectionString 
= 
$" 
$str #
{# $
server$ *
}* +
$str+ 6
{6 7
database7 ?
}? @
$str@ J
{J K
usernameK S
}S T
$strT _
{_ `
password` h
}h i
$str	i ¥
"
¥ ¦
;
¦ §
builder 
. 
Services 
. 
AddDbContext 
< 
AppDBContext *
>* +
(+ ,
options, 3
=>4 6
options 
. 
UseSqlServer 
( 
connectionString )
)) *
)* +
;+ ,
builder 
. 
Services 
. 
AddControllers 
(  
)  !
. 
AddJsonOptions 
( 
options 
=> 
{ 
options 
. !
JsonSerializerOptions %
.% &
ReferenceHandler& 6
=7 8
ReferenceHandler9 I
.I J
PreserveJ R
;R S
} 
) 
; 
builder!! 
.!! 
Services!! 
.!! #
AddEndpointsApiExplorer!! (
(!!( )
)!!) *
;!!* +
builder"" 
."" 
Services"" 
."" 
AddSwaggerGen"" 
("" 
)""  
;""  !
var$$ 
app$$ 
=$$ 	
builder$$
 
.$$ 
Build$$ 
($$ 
)$$ 
;$$ 
if'' 
('' 
app'' 
.'' 
Environment'' 
.'' 
IsDevelopment'' !
(''! "
)''" #
)''# $
{(( 
app)) 
.)) 

UseSwagger)) 
()) 
))) 
;)) 
app** 
.** 
UseSwaggerUI** 
(** 
)** 
;** 
}++ 
app-- 
.-- 
UseHttpsRedirection-- 
(-- 
)-- 
;-- 
app// 
.// 
UseAuthorization// 
(// 
)// 
;// 
app11 
.11 
MapControllers11 
(11 
)11 
;11 
await44 
app44 	
.44	 

RunAsync44
 
(44 
)44 
;44 ÷o
nC:\Users\nahir\source\repos\GestionCitasMedicas\GestionCitasMedicas\Migrations\20250116132317_InitialCreate.cs
	namespace 	
GestionCitasMedicas
 
. 

Migrations (
{ 
public		 

partial		 
class		 
InitialCreate		 &
:		' (
	Migration		) 2
{

 
private 
const 
string 
IdentityAnnotation /
=0 1
$str2 F
;F G
private 
const 
string 
NVarCharMax (
=) *
$str+ :
;: ;
private 
const 
string 
TableNameCitas +
=, -
$str. 5
;5 6
private 
const 
string 
TableNameDoctores .
=/ 0
$str1 ;
;; <
private 
const 
string 
TableNamePacientes /
=0 1
$str2 =
;= >
private 
const 
string #
TableNameProcedimientos 4
=5 6
$str7 G
;G H
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
TableNameDoctores '
,' (
columns 
: 
table 
=> !
new" %
{ 
IdDoctor 
= 
table $
.$ %
Column% +
<+ ,
int, /
>/ 0
(0 1
type1 5
:5 6
$str7 <
,< =
nullable> F
:F G
falseH M
)M N
. 

Annotation #
(# $
IdentityAnnotation$ 6
,6 7
$str8 >
)> ?
,? @
Nombre 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
NVarCharMax8 C
,C D
nullableE M
:M N
falseO T
)T U
,U V
Especialidad  
=! "
table# (
.( )
Column) /
</ 0
string0 6
>6 7
(7 8
type8 <
:< =
NVarCharMax> I
,I J
nullableK S
:S T
falseU Z
)Z [
,[ \
Telefono 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
NVarCharMax: E
,E F
nullableG O
:O P
trueQ U
)U V
,V W
Email 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
type1 5
:5 6
NVarCharMax7 B
,B C
nullableD L
:L M
trueN R
)R S
}   
,   
constraints!! 
:!! 
table!! "
=>!!# %
{"" 
table## 
.## 

PrimaryKey## $
(##$ %
$str##% 2
,##2 3
x##4 5
=>##6 8
x##9 :
.##: ;
IdDoctor##; C
)##C D
;##D E
}$$ 
)$$ 
;$$ 
migrationBuilder&& 
.&& 
CreateTable&& (
(&&( )
name'' 
:'' 
TableNamePacientes'' (
,''( )
columns(( 
:(( 
table(( 
=>(( !
new((" %
{)) 

IdPaciente** 
=**  
table**! &
.**& '
Column**' -
<**- .
int**. 1
>**1 2
(**2 3
type**3 7
:**7 8
$str**9 >
,**> ?
nullable**@ H
:**H I
false**J O
)**O P
.++ 

Annotation++ #
(++# $
IdentityAnnotation++$ 6
,++6 7
$str++8 >
)++> ?
,++? @
Nombre,, 
=,, 
table,, "
.,," #
Column,,# )
<,,) *
string,,* 0
>,,0 1
(,,1 2
type,,2 6
:,,6 7
NVarCharMax,,8 C
,,,C D
nullable,,E M
:,,M N
false,,O T
),,T U
,,,U V
FechaNacimiento-- #
=--$ %
table--& +
.--+ ,
Column--, 2
<--2 3
DateTime--3 ;
>--; <
(--< =
type--= A
:--A B
$str--C N
,--N O
nullable--P X
:--X Y
false--Z _
)--_ `
,--` a
Telefono.. 
=.. 
table.. $
...$ %
Column..% +
<..+ ,
string.., 2
>..2 3
(..3 4
type..4 8
:..8 9
NVarCharMax..: E
,..E F
nullable..G O
:..O P
true..Q U
)..U V
,..V W
	Direccion// 
=// 
table//  %
.//% &
Column//& ,
<//, -
string//- 3
>//3 4
(//4 5
type//5 9
://9 :
NVarCharMax//; F
,//F G
nullable//H P
://P Q
true//R V
)//V W
}00 
,00 
constraints11 
:11 
table11 "
=>11# %
{22 
table33 
.33 

PrimaryKey33 $
(33$ %
$str33% 3
,333 4
x335 6
=>337 9
x33: ;
.33; <

IdPaciente33< F
)33F G
;33G H
}44 
)44 
;44 
migrationBuilder66 
.66 
CreateTable66 (
(66( )
name77 
:77 
TableNameCitas77 $
,77$ %
columns88 
:88 
table88 
=>88 !
new88" %
{99 
IdCita:: 
=:: 
table:: "
.::" #
Column::# )
<::) *
int::* -
>::- .
(::. /
type::/ 3
:::3 4
$str::5 :
,::: ;
nullable::< D
:::D E
false::F K
)::K L
.;; 

Annotation;; #
(;;# $
IdentityAnnotation;;$ 6
,;;6 7
$str;;8 >
);;> ?
,;;? @
Fecha<< 
=<< 
table<< !
.<<! "
Column<<" (
<<<( )
DateTime<<) 1
><<1 2
(<<2 3
type<<3 7
:<<7 8
$str<<9 D
,<<D E
nullable<<F N
:<<N O
false<<P U
)<<U V
,<<V W
Hora== 
=== 
table==  
.==  !
Column==! '
<==' (
TimeSpan==( 0
>==0 1
(==1 2
type==2 6
:==6 7
$str==8 >
,==> ?
nullable==@ H
:==H I
false==J O
)==O P
,==P Q
Motivo>> 
=>> 
table>> "
.>>" #
Column>># )
<>>) *
string>>* 0
>>>0 1
(>>1 2
type>>2 6
:>>6 7
NVarCharMax>>8 C
,>>C D
nullable>>E M
:>>M N
true>>O S
)>>S T
,>>T U

IdPaciente?? 
=??  
table??! &
.??& '
Column??' -
<??- .
int??. 1
>??1 2
(??2 3
type??3 7
:??7 8
$str??9 >
,??> ?
nullable??@ H
:??H I
false??J O
)??O P
,??P Q
IdDoctor@@ 
=@@ 
table@@ $
.@@$ %
Column@@% +
<@@+ ,
int@@, /
>@@/ 0
(@@0 1
type@@1 5
:@@5 6
$str@@7 <
,@@< =
nullable@@> F
:@@F G
false@@H M
)@@M N
}AA 
,AA 
constraintsBB 
:BB 
tableBB "
=>BB# %
{CC 
tableDD 
.DD 

PrimaryKeyDD $
(DD$ %
$strDD% /
,DD/ 0
xDD1 2
=>DD3 5
xDD6 7
.DD7 8
IdCitaDD8 >
)DD> ?
;DD? @
tableEE 
.EE 

ForeignKeyEE $
(EE$ %
nameFF 
:FF 
$strFF :
,FF: ;
columnGG 
:GG 
xGG  !
=>GG" $
xGG% &
.GG& '
IdDoctorGG' /
,GG/ 0
principalTableHH &
:HH& '
TableNameDoctoresHH( 9
,HH9 :
principalColumnII '
:II' (
$strII) 3
,II3 4
onDeleteJJ  
:JJ  !
ReferentialActionJJ" 3
.JJ3 4
CascadeJJ4 ;
)JJ; <
;JJ< =
tableKK 
.KK 

ForeignKeyKK $
(KK$ %
nameLL 
:LL 
$strLL =
,LL= >
columnMM 
:MM 
xMM  !
=>MM" $
xMM% &
.MM& '

IdPacienteMM' 1
,MM1 2
principalTableNN &
:NN& '
TableNamePacientesNN( :
,NN: ;
principalColumnOO '
:OO' (
$strOO) 5
,OO5 6
onDeletePP  
:PP  !
ReferentialActionPP" 3
.PP3 4
CascadePP4 ;
)PP; <
;PP< =
}QQ 
)QQ 
;QQ 
migrationBuilderSS 
.SS 
CreateTableSS (
(SS( )
nameTT 
:TT #
TableNameProcedimientosTT -
,TT- .
columnsUU 
:UU 
tableUU 
=>UU !
newUU" %
{VV 
IdProcedimientoWW #
=WW$ %
tableWW& +
.WW+ ,
ColumnWW, 2
<WW2 3
intWW3 6
>WW6 7
(WW7 8
typeWW8 <
:WW< =
$strWW> C
,WWC D
nullableWWE M
:WWM N
falseWWO T
)WWT U
.XX 

AnnotationXX #
(XX# $
IdentityAnnotationXX$ 6
,XX6 7
$strXX8 >
)XX> ?
,XX? @
DescripcionYY 
=YY  !
tableYY" '
.YY' (
ColumnYY( .
<YY. /
stringYY/ 5
>YY5 6
(YY6 7
typeYY7 ;
:YY; <
NVarCharMaxYY= H
,YYH I
nullableYYJ R
:YYR S
falseYYT Y
)YYY Z
,YYZ [
CostoZZ 
=ZZ 
tableZZ !
.ZZ! "
ColumnZZ" (
<ZZ( )
decimalZZ) 0
>ZZ0 1
(ZZ1 2
typeZZ2 6
:ZZ6 7
$strZZ8 G
,ZZG H
nullableZZI Q
:ZZQ R
falseZZS X
)ZZX Y
,ZZY Z
IdCita[[ 
=[[ 
table[[ "
.[[" #
Column[[# )
<[[) *
int[[* -
>[[- .
([[. /
type[[/ 3
:[[3 4
$str[[5 :
,[[: ;
nullable[[< D
:[[D E
false[[F K
)[[K L
}\\ 
,\\ 
constraints]] 
:]] 
table]] "
=>]]# %
{^^ 
table__ 
.__ 

PrimaryKey__ $
(__$ %
$str__% 8
,__8 9
x__: ;
=>__< >
x__? @
.__@ A
IdProcedimiento__A P
)__P Q
;__Q R
table`` 
.`` 

ForeignKey`` $
(``$ %
nameaa 
:aa 
$straa >
,aa> ?
columnbb 
:bb 
xbb  !
=>bb" $
xbb% &
.bb& '
IdCitabb' -
,bb- .
principalTablecc &
:cc& '
TableNameCitascc( 6
,cc6 7
principalColumndd '
:dd' (
$strdd) 1
,dd1 2
onDeleteee  
:ee  !
ReferentialActionee" 3
.ee3 4
Cascadeee4 ;
)ee; <
;ee< =
}ff 
)ff 
;ff 
migrationBuilderhh 
.hh 
CreateIndexhh (
(hh( )
nameii 
:ii 
$strii )
,ii) *
tablejj 
:jj 
TableNameCitasjj %
,jj% &
columnkk 
:kk 
$strkk "
)kk" #
;kk# $
migrationBuildermm 
.mm 
CreateIndexmm (
(mm( )
namenn 
:nn 
$strnn +
,nn+ ,
tableoo 
:oo 
TableNameCitasoo %
,oo% &
columnpp 
:pp 
$strpp $
)pp$ %
;pp% &
migrationBuilderrr 
.rr 
CreateIndexrr (
(rr( )
namess 
:ss 
$strss 0
,ss0 1
tablett 
:tt #
TableNameProcedimientostt .
,tt. /
columnuu 
:uu 
$struu  
)uu  !
;uu! "
}vv 	
	protectedyy 
overrideyy 
voidyy 
Downyy  $
(yy$ %
MigrationBuilderyy% 5
migrationBuilderyy6 F
)yyF G
{zz 	
migrationBuilder{{ 
.{{ 
	DropTable{{ &
({{& '
name|| 
:|| #
TableNameProcedimientos|| -
)||- .
;||. /
migrationBuilder~~ 
.~~ 
	DropTable~~ &
(~~& '
name 
: 
TableNameCitas $
)$ %
;% &
migrationBuilder
 
.
 
	DropTable
 &
(
& '
name
 
:
 
TableNameDoctores
 '
)
' (
;
( )
migrationBuilder
 
.
 
	DropTable
 &
(
& '
name
 
:
  
TableNamePacientes
 (
)
( )
;
) *
}
 	
}
 
} ú[
kC:\Users\nahir\source\repos\GestionCitasMedicas\GestionCitasMedicas\Controllers\ProcedimientosController.cs
	namespace 	
GestionCitasMedicas
 
. 
Controllers )
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public		 

class		 $
ProcedimientosController		 )
:		* +
ControllerBase		, :
{

 
private 
readonly 
AppDBContext %

_dbContext& 0
;0 1
public $
ProcedimientosController '
(' (
AppDBContext( 4
	dbContext5 >
)> ?
{ 	

_dbContext 
= 
	dbContext "
;" #
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetProcedimientos) :
(: ;
); <
{ 	
var 
procedimientos 
=  
await! &

_dbContext' 1
.1 2
Procedimientos2 @
.@ A
ToListAsyncA L
(L M
)M N
;N O
return 
Ok 
( 
procedimientos $
)$ %
;% &
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
CreateProcedimiento) <
(< =
[= >
FromBody> F
]F G"
CreateProcedimientoDtoH ^
procedimientoDTO_ o
)o p
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return 

BadRequest !
(! "

ModelState" ,
), -
;- .
} 
if!! 
(!! 
!!! 
await!! 

_dbContext!! !
.!!! "
Citas!!" '
.!!' (
AnyAsync!!( 0
(!!0 1
c!!1 2
=>!!3 5
c!!6 7
.!!7 8
IdCita!!8 >
==!!? A
procedimientoDTO!!B R
.!!R S
IdCita!!S Y
)!!Y Z
)!!Z [
{"" 
return## 

BadRequest## !
(##! "
$str##" 3
)##3 4
;##4 5
}$$ 
var&& 
procedimiento&& 
=&& 
new&&  #
Procedimiento&&$ 1
{'' 
IdCita(( 
=(( 
procedimientoDTO(( )
.(() *
IdCita((* 0
,((0 1
Descripcion)) 
=)) 
procedimientoDTO)) .
.)). /
Descripcion))/ :
,)): ;
Costo** 
=** 
procedimientoDTO** (
.**( )
Costo**) .
}++ 
;++ 

_dbContext-- 
.-- 
Procedimientos-- %
.--% &
Add--& )
(--) *
procedimiento--* 7
)--7 8
;--8 9
await.. 

_dbContext.. 
... 
SaveChangesAsync.. -
(..- .
)... /
;../ 0
return// 
Ok// 
(// 
procedimiento// #
)//# $
;//$ %
}00 	
[22 	
HttpPut22	 
(22 
$str22 
)22 
]22 
public33 
async33 
Task33 
<33 
IActionResult33 '
>33' (
UpdateProcedimiento33) <
(33< =
int33= @
id33A C
,33C D
[33E F
FromBody33F N
]33N O"
UpdateProcedimientoDto33P f
procedimientoDTO33g w
)33w x
{44 	
if55 
(55 
!55 

ModelState55 
.55 
IsValid55 #
)55# $
{66 
return77 

BadRequest77 !
(77! "

ModelState77" ,
)77, -
;77- .
}88 
var:: 
procedimiento:: 
=:: 
await::  %

_dbContext::& 0
.::0 1
Procedimientos::1 ?
.::? @
	FindAsync::@ I
(::I J
id::J L
)::L M
;::M N
if;; 
(;; 
procedimiento;; 
==;;  
null;;! %
);;% &
{<< 
return== 
NotFound== 
(==  
$str==  >
)==> ?
;==? @
}>> 
if@@ 
(@@ 
procedimientoDTO@@  
.@@  !
Descripcion@@! ,
!=@@- /
null@@0 4
)@@4 5
{AA 
procedimientoBB 
.BB 
DescripcionBB )
=BB* +
procedimientoDTOBB, <
.BB< =
DescripcionBB= H
;BBH I
}CC 
ifEE 
(EE 
procedimientoDTOEE  
.EE  !
CostoEE! &
.EE& '
HasValueEE' /
)EE/ 0
{FF 
procedimientoGG 
.GG 
CostoGG #
=GG$ %
procedimientoDTOGG& 6
.GG6 7
CostoGG7 <
.GG< =
ValueGG= B
;GGB C
}HH 
ifJJ 
(JJ 
procedimientoDTOJJ  
.JJ  !
IdCitaJJ! '
.JJ' (
HasValueJJ( 0
)JJ0 1
{KK 
procedimientoLL 
.LL 
IdCitaLL $
=LL% &
procedimientoDTOLL' 7
.LL7 8
IdCitaLL8 >
.LL> ?
ValueLL? D
;LLD E
}MM 

_dbContextOO 
.OO 
EntryOO 
(OO 
procedimientoOO *
)OO* +
.OO+ ,
StateOO, 1
=OO2 3
EntityStateOO4 ?
.OO? @
ModifiedOO@ H
;OOH I
tryQQ 
{RR 
awaitSS 

_dbContextSS  
.SS  !
SaveChangesAsyncSS! 1
(SS1 2
)SS2 3
;SS3 4
returnTT 
OkTT 
(TT 
procedimientoTT '
)TT' (
;TT( )
}UU 
catchVV 
(VV (
DbUpdateConcurrencyExceptionVV /
)VV/ 0
{WW 
ifXX 
(XX 
!XX 
ProcedimientoExistsXX (
(XX( )
idXX) +
)XX+ ,
)XX, -
{YY 
returnZZ 
NotFoundZZ #
(ZZ# $
$strZZ$ B
)ZZB C
;ZZC D
}[[ 
else\\ 
{]] 
throw^^ 
;^^ 
}__ 
}`` 
}aa 	
[cc 	

HttpDeletecc	 
(cc 
$strcc 
)cc 
]cc 
publicdd 
asyncdd 
Taskdd 
<dd 
IActionResultdd '
>dd' (
DeleteProcedimientodd) <
(dd< =
intdd= @
idddA C
)ddC D
{ee 	
varff 
procedimientoff 
=ff 
awaitff  %

_dbContextff& 0
.ff0 1
Procedimientosff1 ?
.ff? @
	FindAsyncff@ I
(ffI J
idffJ L
)ffL M
;ffM N
ifgg 
(gg 
procedimientogg 
==gg  
nullgg! %
)gg% &
{hh 
returnii 
NotFoundii 
(ii  
$strii  >
)ii> ?
;ii? @
}jj 

_dbContextll 
.ll 
Procedimientosll %
.ll% &
Removell& ,
(ll, -
procedimientoll- :
)ll: ;
;ll; <
awaitmm 

_dbContextmm 
.mm 
SaveChangesAsyncmm -
(mm- .
)mm. /
;mm/ 0
returnnn 
Oknn 
(nn 
$"nn 
$strnn -
{nn- .
idnn. 0
}nn0 1
$strnn1 J
"nnJ K
)nnK L
;nnL M
}oo 	
privateqq 
boolqq 
ProcedimientoExistsqq (
(qq( )
intqq) ,
idqq- /
)qq/ 0
{rr 	
returnss 

_dbContextss 
.ss 
Procedimientosss ,
.ss, -
Anyss- 0
(ss0 1
ess1 2
=>ss3 5
ess6 7
.ss7 8
IdProcedimientoss8 G
==ssH J
idssK M
)ssM N
;ssN O
}tt 	
}uu 
publicww 

classww "
CreateProcedimientoDtoww '
{xx 
[yy 	
Requiredyy	 
(yy 
ErrorMessageyy 
=yy  
$stryy! C
)yyC D
]yyD E
[zz 	
Rangezz	 
(zz 
$numzz 
,zz 
intzz 
.zz 
MaxValuezz 
,zz 
ErrorMessagezz  ,
=zz- .
$strzz/ ^
)zz^ _
]zz_ `
public{{ 
int{{ 
IdCita{{ 
{{{ 
get{{ 
;{{  
set{{! $
;{{$ %
}{{& '
[}} 	
Required}}	 
(}} 
ErrorMessage}} 
=}}  
$str}}! S
)}}S T
]}}T U
[~~ 	
StringLength~~	 
(~~ 
$num~~ 
,~~ 
ErrorMessage~~ '
=~~( )
$str~~* _
)~~_ `
]~~` a
public 
string 
? 
Descripcion "
{# $
get% (
;( )
set* -
;- .
}/ 0
[
 	
Required
	 
(
 
ErrorMessage
 
=
  
$str
! ;
)
; <
]
< =
[
 	
Range
	 
(
 
$num
 
,
 
double
 
.
 
MaxValue
 $
,
$ %
ErrorMessage
& 2
=
3 4
$str
5 _
)
_ `
]
` a
public
 
decimal
 
Costo
 
{
 
get
 "
;
" #
set
$ '
;
' (
}
) *
}
 
public
 

class
 $
UpdateProcedimientoDto
 '
{
 
[
 	
Range
	 
(
 
$num
 
,
 
int
 
.
 
MaxValue
 
,
 
ErrorMessage
  ,
=
- .
$str
/ ^
)
^ _
]
_ `
public
 
int
 
?
 
IdCita
 
{
 
get
  
;
  !
set
" %
;
% &
}
' (
[
 	
StringLength
	 
(
 
$num
 
,
 
ErrorMessage
 '
=
( )
$str
* _
)
_ `
]
` a
public
 
string
 
?
 
Descripcion
 "
{
# $
get
% (
;
( )
set
* -
;
- .
}
/ 0
[
 	
Range
	 
(
 
$num
 
,
 
double
 
.
 
MaxValue
 $
,
$ %
ErrorMessage
& 2
=
3 4
$str
5 _
)
_ `
]
` a
public
 
decimal
 
?
 
Costo
 
{
 
get
  #
;
# $
set
% (
;
( )
}
* +
}
 
} ¼y
eC:\Users\nahir\source\repos\GestionCitasMedicas\GestionCitasMedicas\Controllers\DoctoresController.cs
	namespace 	
GestionCitasMedicas
 
. 
Controllers )
{ 
[ 
Route 

(
 
$str 
) 
] 
[		 
ApiController		 
]		 
public

 

class

 
DoctoresController

 #
:

$ %
ControllerBase

& 4
{ 
private 
readonly 
AppDBContext %

_dbContext& 0
;0 1
public 
DoctoresController !
(! "
AppDBContext" .
	dbContext/ 8
)8 9
{ 	

_dbContext 
= 
	dbContext "
;" #
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetDoctores) 4
(4 5
)5 6
{ 	
var 
doctores 
= 
await  

_dbContext! +
.+ ,
Doctores, 4
.4 5
ToListAsync5 @
(@ A
)A B
;B C
return 
Ok 
( 
doctores 
) 
;  
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
CreateDoctor) 5
(5 6
[6 7
FromBody7 ?
]? @
	DoctorDtoA J
	doctorDtoK T
)T U
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return 

BadRequest !
(! "

ModelState" ,
), -
;- .
}   
var"" 
doctor"" 
="" 
new"" 
Doctor"" #
{## 
Nombre$$ 
=$$ 
	doctorDto$$ "
.$$" #
Nombre$$# )
??$$* ,
string$$- 3
.$$3 4
Empty$$4 9
,$$9 :
Especialidad%% 
=%% 
	doctorDto%% (
.%%( )
Especialidad%%) 5
??%%6 8
string%%9 ?
.%%? @
Empty%%@ E
,%%E F
Telefono&& 
=&& 
	doctorDto&& $
.&&$ %
Telefono&&% -
,&&- .
Email'' 
='' 
	doctorDto'' !
.''! "
Email''" '
,''' (
Subespecialidad(( 
=((  !
	doctorDto((" +
.((+ ,
Subespecialidad((, ;
??((< >
string((? E
.((E F
Empty((F K
})) 
;)) 

_dbContext++ 
.++ 
Doctores++ 
.++  
Add++  #
(++# $
doctor++$ *
)++* +
;+++ ,
await,, 

_dbContext,, 
.,, 
SaveChangesAsync,, -
(,,- .
),,. /
;,,/ 0
return.. 
CreatedAtAction.. "
(.." #
nameof..# )
(..) *
GetDoctores..* 5
)..5 6
,..6 7
new..8 ;
{..< =
id..> @
=..A B
doctor..C I
...I J
IdDoctor..J R
}..S T
,..T U
doctor..V \
)..\ ]
;..] ^
}// 	
[11 	
HttpPut11	 
(11 
$str11 
)11 
]11 
public22 
async22 
Task22 
<22 
IActionResult22 '
>22' (
UpdateDoctor22) 5
(225 6
int226 9
id22: <
,22< =
[22> ?
FromBody22? G
]22G H
DoctorUpdateDto22I X
doctorUpdateDto22Y h
)22h i
{33 	
if44 
(44 
!44 

ModelState44 
.44 
IsValid44 #
)44# $
{55 
return66 

BadRequest66 !
(66! "

ModelState66" ,
)66, -
;66- .
}77 
var99 
doctor99 
=99 
await99 

_dbContext99 )
.99) *
Doctores99* 2
.992 3
	FindAsync993 <
(99< =
id99= ?
)99? @
;99@ A
if:: 
(:: 
doctor:: 
==:: 
null:: 
):: 
{;; 
return<< 
NotFound<< 
(<<  
$str<<  7
)<<7 8
;<<8 9
}== 
doctor@@ 
.@@ 
Nombre@@ 
=@@ 
doctorUpdateDto@@ +
.@@+ ,
Nombre@@, 2
??@@3 5
doctor@@6 <
.@@< =
Nombre@@= C
;@@C D
doctorAA 
.AA 
EspecialidadAA 
=AA  !
doctorUpdateDtoAA" 1
.AA1 2
EspecialidadAA2 >
??AA? A
doctorAAB H
.AAH I
EspecialidadAAI U
;AAU V
doctorBB 
.BB 
TelefonoBB 
=BB 
doctorUpdateDtoBB -
.BB- .
TelefonoBB. 6
??BB7 9
doctorBB: @
.BB@ A
TelefonoBBA I
;BBI J
doctorCC 
.CC 
EmailCC 
=CC 
doctorUpdateDtoCC *
.CC* +
EmailCC+ 0
??CC1 3
doctorCC4 :
.CC: ;
EmailCC; @
;CC@ A
doctorDD 
.DD 
SubespecialidadDD "
=DD# $
doctorUpdateDtoDD% 4
.DD4 5
SubespecialidadDD5 D
??DDE G
doctorDDH N
.DDN O
SubespecialidadDDO ^
;DD^ _

_dbContextFF 
.FF 
EntryFF 
(FF 
doctorFF #
)FF# $
.FF$ %
StateFF% *
=FF+ ,
EntityStateFF- 8
.FF8 9
ModifiedFF9 A
;FFA B
tryHH 
{II 
awaitJJ 

_dbContextJJ  
.JJ  !
SaveChangesAsyncJJ! 1
(JJ1 2
)JJ2 3
;JJ3 4
returnKK 
OkKK 
(KK 
doctorKK  
)KK  !
;KK! "
}LL 
catchMM 
(MM (
DbUpdateConcurrencyExceptionMM /
)MM/ 0
{NN 
ifOO 
(OO 
!OO 
DoctorExistsOO !
(OO! "
idOO" $
)OO$ %
)OO% &
{PP 
returnQQ 
NotFoundQQ #
(QQ# $
$strQQ$ ;
)QQ; <
;QQ< =
}RR 
elseSS 
{TT 
throwUU 
;UU 
}VV 
}WW 
}XX 	
[[[ 	

HttpDelete[[	 
([[ 
$str[[ 
)[[ 
][[ 
public\\ 
async\\ 
Task\\ 
<\\ 
IActionResult\\ '
>\\' (
DeleteDoctor\\) 5
(\\5 6
int\\6 9
id\\: <
)\\< =
{]] 	
var^^ 
doctor^^ 
=^^ 
await^^ 

_dbContext^^ )
.^^) *
Doctores^^* 2
.^^2 3
	FindAsync^^3 <
(^^< =
id^^= ?
)^^? @
;^^@ A
if__ 
(__ 
doctor__ 
==__ 
null__ 
)__ 
{`` 
returnaa 
NotFoundaa 
(aa  
$straa  7
)aa7 8
;aa8 9
}bb 
vardd 
citasExistentesdd 
=dd  !
awaitdd" '

_dbContextdd( 2
.dd2 3
Citasdd3 8
.dd8 9
AnyAsyncdd9 A
(ddA B
cddB C
=>ddD F
cddG H
.ddH I
IdDoctorddI Q
==ddR T
idddU W
)ddW X
;ddX Y
ifee 
(ee 
citasExistentesee 
)ee  
{ff 
returngg 

BadRequestgg !
(gg! "
$strgg" `
)gg` a
;gga b
}hh 

_dbContextjj 
.jj 
Doctoresjj 
.jj  
Removejj  &
(jj& '
doctorjj' -
)jj- .
;jj. /
awaitkk 

_dbContextkk 
.kk 
SaveChangesAsynckk -
(kk- .
)kk. /
;kk/ 0
returnmm 
Okmm 
(mm 
$"mm 
$strmm &
{mm& '
idmm' )
}mm) *
$strmm* C
"mmC D
)mmD E
;mmE F
}nn 	
privatepp 
boolpp 
DoctorExistspp !
(pp! "
intpp" %
idpp& (
)pp( )
{qq 	
returnrr 

_dbContextrr 
.rr 
Doctoresrr &
.rr& '
Anyrr' *
(rr* +
err+ ,
=>rr- /
err0 1
.rr1 2
IdDoctorrr2 :
==rr; =
idrr> @
)rr@ A
;rrA B
}ss 	
}tt 
publicvv 

classvv 
	DoctorDtovv 
{ww 
[xx 	
Requiredxx	 
(xx 
ErrorMessagexx 
=xx  
$strxx! <
)xx< =
]xx= >
[yy 	
StringLengthyy	 
(yy 
$numyy 
,yy 
ErrorMessageyy '
=yy( )
$stryy* Z
)yyZ [
]yy[ \
[zz 	
RegularExpressionzz	 
(zz 
$strzz +
,zz+ ,
ErrorMessagezz- 9
=zz: ;
$strzz< n
)zzn o
]zzo p
public{{ 
string{{ 
?{{ 
Nombre{{ 
{{{ 
get{{  #
;{{# $
set{{% (
;{{( )
}{{* +
[}} 	
Required}}	 
(}} 
ErrorMessage}} 
=}}  
$str}}! B
)}}B C
]}}C D
[~~ 	
StringLength~~	 
(~~ 
$num~~ 
,~~ 
ErrorMessage~~ '
=~~( )
$str~~* `
)~~` a
]~~a b
[ 	
RegularExpression	 
( 
$str +
,+ ,
ErrorMessage- 9
=: ;
$str< t
)t u
]u v
public
 
string
 
?
 
Especialidad
 #
{
$ %
get
& )
;
) *
set
+ .
;
. /
}
0 1
[
 	
Phone
	 
(
 
ErrorMessage
 
=
 
$str
 C
)
C D
]
D E
[
 	
RegularExpression
	 
(
 
$str
 3
,
3 4
ErrorMessage
5 A
=
B C
$str
D m
)
m n
]
n o
public
 
string
 
?
 
Telefono
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
[
 	
EmailAddress
	 
(
 
ErrorMessage
 "
=
# $
$str
% V
)
V W
]
W X
[
 	
RegularExpression
	 
(
 
$str
 N
,
N O
ErrorMessage
P \
=
] ^
$str_ 
) 
] 
public
 
string
 
?
 
Email
 
{
 
get
 "
;
" #
set
$ '
;
' (
}
) *
[
 	
StringLength
	 
(
 
$num
 
,
 
ErrorMessage
 '
=
( )
$str
* c
)
c d
]
d e
[
 	
RegularExpression
	 
(
 
$str
 +
,
+ ,
ErrorMessage
- 9
=
: ;
$str
< w
)
w x
]
x y
public
 
string
 
?
 
Subespecialidad
 &
{
' (
get
) ,
;
, -
set
. 1
;
1 2
}
3 4
}
 
public
 

class
 
DoctorUpdateDto
  
{
 
[
 	
StringLength
	 
(
 
$num
 
,
 
ErrorMessage
 '
=
( )
$str
* Z
)
Z [
]
[ \
[
 	
RegularExpression
	 
(
 
$str
 +
,
+ ,
ErrorMessage
- 9
=
: ;
$str
< n
)
n o
]
o p
[
 	
	MinLength
	 
(
 
$num
 
,
 
ErrorMessage
 "
=
# $
$str
% F
)
F G
]
G H
public
 
string
 
?
 
Nombre
 
{
 
get
  #
;
# $
set
% (
;
( )
}
* +
[
 	
StringLength
	 
(
 
$num
 
,
 
ErrorMessage
 '
=
( )
$str
* `
)
` a
]
a b
[
 	
RegularExpression
	 
(
 
$str
 +
,
+ ,
ErrorMessage
- 9
=
: ;
$str
< t
)
t u
]
u v
public
 
string
 
?
 
Especialidad
 #
{
$ %
get
& )
;
) *
set
+ .
;
. /
}
0 1
[
 	
Phone
	 
(
 
ErrorMessage
 
=
 
$str
 C
)
C D
]
D E
[
 	
RegularExpression
	 
(
 
$str
 3
,
3 4
ErrorMessage
5 A
=
B C
$str
D m
)
m n
]
n o
public
 
string
 
?
 
Telefono
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
[
 	
EmailAddress
	 
(
 
ErrorMessage
 "
=
# $
$str
% V
)
V W
]
W X
[
 	
RegularExpression
	 
(
 
$str
 N
,
N O
ErrorMessage
P \
=
] ^
$str_ 
) 
] 
public
   
string
   
?
   
Email
   
{
   
get
   "
;
  " #
set
  $ '
;
  ' (
}
  ) *
[
¢¢ 	
StringLength
¢¢	 
(
¢¢ 
$num
¢¢ 
,
¢¢ 
ErrorMessage
¢¢ '
=
¢¢( )
$str
¢¢* c
)
¢¢c d
]
¢¢d e
[
££ 	
RegularExpression
££	 
(
££ 
$str
££ +
,
££+ ,
ErrorMessage
££- 9
=
££: ;
$str
££< w
)
££w x
]
££x y
public
¤¤ 
string
¤¤ 
?
¤¤ 
Subespecialidad
¤¤ &
{
¤¤' (
get
¤¤) ,
;
¤¤, -
set
¤¤. 1
;
¤¤1 2
}
¤¤3 4
}
¥¥ 
}¦¦ Úo
fC:\Users\nahir\source\repos\GestionCitasMedicas\GestionCitasMedicas\Controllers\PacientesController.cs
	namespace 	
GestionCitasMedicas
 
. 
Controllers )
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public		 

class		 
PacientesController		 $
:		% &
ControllerBase		' 5
{

 
private 
readonly 
AppDBContext %

_dbContext& 0
;0 1
public 
PacientesController "
(" #
AppDBContext# /
	dbContext0 9
)9 :
{ 	

_dbContext 
= 
	dbContext "
;" #
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetPacientes) 5
(5 6
)6 7
{ 	
var 
	pacientes 
= 
await !

_dbContext" ,
., -
	Pacientes- 6
.6 7
ToListAsync7 B
(B C
)C D
;D E
return 
Ok 
( 
	pacientes 
)  
;  !
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
CreatePaciente) 7
(7 8
[8 9
FromBody9 A
]A B
PacienteDtoC N
pacienteDtoO Z
)Z [
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return 

BadRequest !
(! "

ModelState" ,
), -
;- .
} 
var!! 
paciente!! 
=!! 
new!! 
Paciente!! '
{"" 
Nombre## 
=## 
pacienteDto## $
.##$ %
Nombre##% +
??##, .
string##/ 5
.##5 6
Empty##6 ;
,##; <
FechaNacimiento$$ 
=$$  !
pacienteDto$$" -
.$$- .
FechaNacimiento$$. =
,$$= >
Telefono%% 
=%% 
pacienteDto%% &
.%%& '
Telefono%%' /
,%%/ 0
	Direccion&& 
=&& 
pacienteDto&& '
.&&' (
	Direccion&&( 1
}'' 
;'' 

_dbContext)) 
.)) 
	Pacientes))  
.))  !
Add))! $
())$ %
paciente))% -
)))- .
;)). /
await** 

_dbContext** 
.** 
SaveChangesAsync** -
(**- .
)**. /
;**/ 0
return,, 
CreatedAtAction,, "
(,," #
nameof,,# )
(,,) *
GetPacientes,,* 6
),,6 7
,,,7 8
new,,9 <
{,,= >
id,,? A
=,,B C
paciente,,D L
.,,L M

IdPaciente,,M W
},,X Y
,,,Y Z
paciente,,[ c
),,c d
;,,d e
}-- 	
[00 	
HttpPut00	 
(00 
$str00 
)00 
]00 
public11 
async11 
Task11 
<11 
IActionResult11 '
>11' (
UpdatePaciente11) 7
(117 8
int118 ;
id11< >
,11> ?
[11@ A
FromBody11A I
]11I J
PacienteUpdateDto11K \
pacienteUpdateDto11] n
)11n o
{22 	
if33 
(33 
!33 

ModelState33 
.33 
IsValid33 #
)33# $
{44 
return55 

BadRequest55 !
(55! "

ModelState55" ,
)55, -
;55- .
}66 
var88 
paciente88 
=88 
await88  

_dbContext88! +
.88+ ,
	Pacientes88, 5
.885 6
	FindAsync886 ?
(88? @
id88@ B
)88B C
;88C D
if99 
(99 
paciente99 
==99 
null99  
)99  !
{:: 
return;; 
NotFound;; 
(;;  
$str;;  9
);;9 :
;;;: ;
}<< 
paciente>> 
.>> 
Nombre>> 
=>> 
pacienteUpdateDto>> /
.>>/ 0
Nombre>>0 6
??>>7 9
paciente>>: B
.>>B C
Nombre>>C I
;>>I J
paciente?? 
.?? 
FechaNacimiento?? $
=??% &
pacienteUpdateDto??' 8
.??8 9
FechaNacimiento??9 H
????I K
paciente??L T
.??T U
FechaNacimiento??U d
;??d e
paciente@@ 
.@@ 
Telefono@@ 
=@@ 
pacienteUpdateDto@@  1
.@@1 2
Telefono@@2 :
??@@; =
paciente@@> F
.@@F G
Telefono@@G O
;@@O P
pacienteAA 
.AA 
	DireccionAA 
=AA  
pacienteUpdateDtoAA! 2
.AA2 3
	DireccionAA3 <
??AA= ?
pacienteAA@ H
.AAH I
	DireccionAAI R
;AAR S

_dbContextCC 
.CC 
EntryCC 
(CC 
pacienteCC %
)CC% &
.CC& '
StateCC' ,
=CC- .
EntityStateCC/ :
.CC: ;
ModifiedCC; C
;CCC D
tryEE 
{FF 
awaitGG 

_dbContextGG  
.GG  !
SaveChangesAsyncGG! 1
(GG1 2
)GG2 3
;GG3 4
returnHH 
OkHH 
(HH 
pacienteHH "
)HH" #
;HH# $
}II 
catchJJ 
(JJ (
DbUpdateConcurrencyExceptionJJ /
)JJ/ 0
{KK 
ifLL 
(LL 
!LL 
PacienteExistsLL #
(LL# $
idLL$ &
)LL& '
)LL' (
{MM 
returnNN 
NotFoundNN #
(NN# $
$strNN$ =
)NN= >
;NN> ?
}OO 
elsePP 
{QQ 
throwRR 
;RR 
}SS 
}TT 
}UU 	
[WW 	

HttpDeleteWW	 
(WW 
$strWW 
)WW 
]WW 
publicXX 
asyncXX 
TaskXX 
<XX 
IActionResultXX '
>XX' (
DeletePacienteXX) 7
(XX7 8
intXX8 ;
idXX< >
)XX> ?
{YY 	
varZZ 
pacienteZZ 
=ZZ 
awaitZZ  

_dbContextZZ! +
.ZZ+ ,
	PacientesZZ, 5
.ZZ5 6
	FindAsyncZZ6 ?
(ZZ? @
idZZ@ B
)ZZB C
;ZZC D
if[[ 
([[ 
paciente[[ 
==[[ 
null[[  
)[[  !
{\\ 
return]] 
NotFound]] 
(]]  
$str]]  9
)]]9 :
;]]: ;
}^^ 
var`` 
citasAsociadas`` 
=``  
await``! &

_dbContext``' 1
.``1 2
Citas``2 7
.``7 8
AnyAsync``8 @
(``@ A
c``A B
=>``C E
c``F G
.``G H

IdPaciente``H R
==``S U
id``V X
)``X Y
;``Y Z
ifaa 
(aa 
citasAsociadasaa 
)aa 
{bb 
returncc 

BadRequestcc !
(cc! "
$strcc" c
)ccc d
;ccd e
}dd 

_dbContextff 
.ff 
	Pacientesff  
.ff  !
Removeff! '
(ff' (
pacienteff( 0
)ff0 1
;ff1 2
awaitgg 

_dbContextgg 
.gg 
SaveChangesAsyncgg -
(gg- .
)gg. /
;gg/ 0
returnii 
Okii 
(ii 
$"ii 
$strii (
{ii( )
idii) +
}ii+ ,
$strii, E
"iiE F
)iiF G
;iiG H
}jj 	
privatell 
boolll 
PacienteExistsll #
(ll# $
intll$ '
idll( *
)ll* +
{mm 	
returnnn 

_dbContextnn 
.nn 
	Pacientesnn '
.nn' (
Anynn( +
(nn+ ,
enn, -
=>nn. 0
enn1 2
.nn2 3

IdPacientenn3 =
==nn> @
idnnA C
)nnC D
;nnD E
}oo 	
}pp 
publicrr 

classrr 
PacienteDtorr 
{ss 
[tt 	
Requiredtt	 
(tt 
ErrorMessagett 
=tt  
$strtt! <
)tt< =
]tt= >
[uu 	
StringLengthuu	 
(uu 
$numuu 
,uu 
ErrorMessageuu '
=uu( )
$struu* Z
)uuZ [
]uu[ \
[vv 	
RegularExpressionvv	 
(vv 
$strvv +
,vv+ ,
ErrorMessagevv- 9
=vv: ;
$strvv< n
)vvn o
]vvo p
publicww 
stringww 
?ww 
Nombreww 
{ww 
getww  #
;ww# $
setww% (
;ww( )
}ww* +
[yy 	
Requiredyy	 
(yy 
ErrorMessageyy 
=yy  
$stryy! I
)yyI J
]yyJ K
[zz 	
DataTypezz	 
(zz 
DataTypezz 
.zz 
Datezz 
,zz  
ErrorMessagezz! -
=zz. /
$strzz0 s
)zzs t
]zzt u
[{{ 	
Range{{	 
({{ 
typeof{{ 
({{ 
DateTime{{ 
){{ 
,{{  
$str{{! -
,{{- .
$str{{/ ;
,{{; <
ErrorMessage{{= I
={{J K
$str	{{L 
)
{{ 
]
{{ 
public|| 
DateTime|| 
FechaNacimiento|| '
{||( )
get||* -
;||- .
set||/ 2
;||2 3
}||4 5
[~~ 	
Phone~~	 
(~~ 
ErrorMessage~~ 
=~~ 
$str~~ C
)~~C D
]~~D E
[ 	
RegularExpression	 
( 
$str 3
,3 4
ErrorMessage5 A
=B C
$strD u
)u v
]v w
public
 
string
 
?
 
Telefono
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
[
 	
StringLength
	 
(
 
$num
 
,
 
ErrorMessage
 '
=
( )
$str
* ]
)
] ^
]
^ _
[
 	
RegularExpression
	 
(
 
$str
 2
,
2 3
ErrorMessage
4 @
=
A B
$strC ¥
)¥ ¦
]¦ §
public
 
string
 
?
 
	Direccion
  
{
! "
get
# &
;
& '
set
( +
;
+ ,
}
- .
}
 
public
 

class
 
PacienteUpdateDto
 "
{
 
[
 	
StringLength
	 
(
 
$num
 
,
 
ErrorMessage
 '
=
( )
$str
* Z
)
Z [
]
[ \
[
 	
RegularExpression
	 
(
 
$str
 +
,
+ ,
ErrorMessage
- 9
=
: ;
$str
< n
)
n o
]
o p
[
 	
	MinLength
	 
(
 
$num
 
,
 
ErrorMessage
 "
=
# $
$str
% F
)
F G
]
G H
public
 
string
 
?
 
Nombre
 
{
 
get
  #
;
# $
set
% (
;
( )
}
* +
[
 	
DataType
	 
(
 
DataType
 
.
 
Date
 
,
  
ErrorMessage
! -
=
. /
$str
0 s
)
s t
]
t u
[
 	
Range
	 
(
 
typeof
 
(
 
DateTime
 
)
 
,
  
$str
! -
,
- .
$str
/ ;
,
; <
ErrorMessage
= I
=
J K
$strL 
) 
] 
public
 
DateTime
 
?
 
FechaNacimiento
 (
{
) *
get
+ .
;
. /
set
0 3
;
3 4
}
5 6
[
 	
Phone
	 
(
 
ErrorMessage
 
=
 
$str
 C
)
C D
]
D E
[
 	
RegularExpression
	 
(
 
$str
 3
,
3 4
ErrorMessage
5 A
=
B C
$str
D u
)
u v
]
v w
public
 
string
 
?
 
Telefono
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
[
 	
StringLength
	 
(
 
$num
 
,
 
ErrorMessage
 '
=
( )
$str
* ]
)
] ^
]
^ _
[
 	
RegularExpression
	 
(
 
$str
 2
,
2 3
ErrorMessage
4 @
=
A B
$strC ¥
)¥ ¦
]¦ §
public
 
string
 
?
 
	Direccion
  
{
! "
get
# &
;
& '
set
( +
;
+ ,
}
- .
}
 
} þ
bC:\Users\nahir\source\repos\GestionCitasMedicas\GestionCitasMedicas\Controllers\CitasController.cs
	namespace 	
GestionCitasMedicas
 
. 
Controllers )
{ 
[ 
Route 

(
 
$str 
) 
] 
[		 
ApiController		 
]		 
public

 

class

 
CitasController

  
:

! "
ControllerBase

# 1
{ 
private 
readonly 
AppDBContext %

_dbContext& 0
;0 1
public 
CitasController 
( 
AppDBContext +
	dbContext, 5
)5 6
{ 	

_dbContext 
= 
	dbContext "
;" #
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetCitas) 1
(1 2
)2 3
{ 	
var 
citas 
= 
await 

_dbContext (
.( )
Citas) .
.. /
ToListAsync/ :
(: ;
); <
;< =
return 
Ok 
( 
citas 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (

CreateCita) 3
(3 4
[4 5
FromBody5 =
]= >
CreateCitaDto? L
citaDTOM T
)T U
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return 

BadRequest !
(! "

ModelState" ,
), -
;- .
}   
if"" 
("" 
!"" 
await"" 

_dbContext"" !
.""! "
	Pacientes""" +
.""+ ,
AnyAsync"", 4
(""4 5
p""5 6
=>""7 9
p"": ;
.""; <

IdPaciente""< F
==""G I
citaDTO""J Q
.""Q R

IdPaciente""R \
)""\ ]
||""^ `
!## 
await## 

_dbContext## !
.##! "
Doctores##" *
.##* +
AnyAsync##+ 3
(##3 4
d##4 5
=>##6 8
d##9 :
.##: ;
IdDoctor##; C
==##D F
citaDTO##G N
.##N O
IdDoctor##O W
)##W X
)##X Y
{$$ 
return%% 

BadRequest%% !
(%%! "
$str%%" @
)%%@ A
;%%A B
}&& 
if(( 
((( 
!(( 
TimeSpan(( 
.(( 
TryParse(( "
(((" #
citaDTO((# *
.((* +
Hora((+ /
,((/ 0
new((1 4
CultureInfo((5 @
(((@ A
$str((A H
)((H I
,((I J
out((K N
var((O R
hora((S W
)((W X
)((X Y
{)) 
return** 

BadRequest** !
(**! "
$str**" Q
)**Q R
;**R S
}++ 
var-- 
cita-- 
=-- 
new-- 
Cita-- 
{.. 

IdPaciente// 
=// 
citaDTO// $
.//$ %

IdPaciente//% /
,/// 0
IdDoctor00 
=00 
citaDTO00 "
.00" #
IdDoctor00# +
,00+ ,
Fecha11 
=11 
citaDTO11 
.11  
Fecha11  %
,11% &
Hora22 
=22 
hora22 
,22 
Motivo33 
=33 
citaDTO33  
.33  !
Motivo33! '
}44 
;44 

_dbContext66 
.66 
Citas66 
.66 
Add66  
(66  !
cita66! %
)66% &
;66& '
await77 

_dbContext77 
.77 
SaveChangesAsync77 -
(77- .
)77. /
;77/ 0
return88 
Ok88 
(88 
cita88 
)88 
;88 
}99 	
[;; 	
HttpPut;;	 
(;; 
$str;; 
);; 
];; 
public<< 
async<< 
Task<< 
<<< 
IActionResult<< '
><<' (

UpdateCita<<) 3
(<<3 4
int<<4 7
id<<8 :
,<<: ;
[<<< =
FromBody<<= E
]<<E F
UpdateCitaDto<<G T
citaDTO<<U \
)<<\ ]
{== 	
if>> 
(>> 
!>> 

ModelState>> 
.>> 
IsValid>> #
)>># $
{?? 
return@@ 

BadRequest@@ !
(@@! "

ModelState@@" ,
)@@, -
;@@- .
}AA 
varCC 
citaCC 
=CC 
awaitCC 

_dbContextCC '
.CC' (
CitasCC( -
.CC- .
	FindAsyncCC. 7
(CC7 8
idCC8 :
)CC: ;
;CC; <
ifDD 
(DD 
citaDD 
==DD 
nullDD 
)DD 
{EE 
returnFF 
NotFoundFF 
(FF  
$strFF  5
)FF5 6
;FF6 7
}GG 
ifII 
(II 
citaDTOII 
.II 
FechaII 
.II 
HasValueII &
)II& '
{JJ 
citaKK 
.KK 
FechaKK 
=KK 
citaDTOKK $
.KK$ %
FechaKK% *
.KK* +
ValueKK+ 0
;KK0 1
}LL 
ifNN 
(NN 
!NN 
stringNN 
.NN 
IsNullOrEmptyNN %
(NN% &
citaDTONN& -
.NN- .
HoraNN. 2
)NN2 3
)NN3 4
{OO 
ifPP 
(PP 
!PP 
TimeSpanPP 
.PP 
TryParsePP &
(PP& '
citaDTOPP' .
.PP. /
HoraPP/ 3
,PP3 4
newPP5 8
CultureInfoPP9 D
(PPD E
$strPPE L
)PPL M
,PPM N
outPPO R
varPPS V
horaPPW [
)PP[ \
)PP\ ]
{QQ 
returnRR 

BadRequestRR %
(RR% &
$strRR& U
)RRU V
;RRV W
}SS 
citaTT 
.TT 
HoraTT 
=TT 
horaTT  
;TT  !
}UU 
ifWW 
(WW 
!WW 
stringWW 
.WW 
IsNullOrEmptyWW %
(WW% &
citaDTOWW& -
.WW- .
MotivoWW. 4
)WW4 5
)WW5 6
{XX 
citaYY 
.YY 
MotivoYY 
=YY 
citaDTOYY %
.YY% &
MotivoYY& ,
;YY, -
}ZZ 
if\\ 
(\\ 
citaDTO\\ 
.\\ 

IdPaciente\\ "
.\\" #
HasValue\\# +
&&\\, .
citaDTO\\/ 6
.\\6 7

IdPaciente\\7 A
.\\A B
Value\\B G
>\\H I
$num\\J K
)\\K L
{]] 
cita^^ 
.^^ 

IdPaciente^^ 
=^^  !
citaDTO^^" )
.^^) *

IdPaciente^^* 4
.^^4 5
Value^^5 :
;^^: ;
}__ 
ifaa 
(aa 
citaDTOaa 
.aa 
IdDoctoraa  
.aa  !
HasValueaa! )
&&aa* ,
citaDTOaa- 4
.aa4 5
IdDoctoraa5 =
.aa= >
Valueaa> C
>aaD E
$numaaF G
)aaG H
{bb 
citacc 
.cc 
IdDoctorcc 
=cc 
citaDTOcc  '
.cc' (
IdDoctorcc( 0
.cc0 1
Valuecc1 6
;cc6 7
}dd 

_dbContextff 
.ff 
Entryff 
(ff 
citaff !
)ff! "
.ff" #
Stateff# (
=ff) *
EntityStateff+ 6
.ff6 7
Modifiedff7 ?
;ff? @
tryhh 
{ii 
awaitjj 

_dbContextjj  
.jj  !
SaveChangesAsyncjj! 1
(jj1 2
)jj2 3
;jj3 4
returnkk 
Okkk 
(kk 
citakk 
)kk 
;kk  
}ll 
catchmm 
(mm (
DbUpdateConcurrencyExceptionmm /
)mm/ 0
{nn 
ifoo 
(oo 
!oo 

CitaExistsoo 
(oo  
idoo  "
)oo" #
)oo# $
{pp 
returnqq 
NotFoundqq #
(qq# $
$strqq$ 9
)qq9 :
;qq: ;
}rr 
elsess 
{tt 
throwuu 
;uu 
}vv 
}ww 
}xx 	
[zz 	

HttpDeletezz	 
(zz 
$strzz 
)zz 
]zz 
public{{ 
async{{ 
Task{{ 
<{{ 
IActionResult{{ '
>{{' (

DeleteCita{{) 3
({{3 4
int{{4 7
id{{8 :
){{: ;
{|| 	
var}} 
cita}} 
=}} 
await}} 

_dbContext}} '
.}}' (
Citas}}( -
.}}- .
	FindAsync}}. 7
(}}7 8
id}}8 :
)}}: ;
;}}; <
if~~ 
(~~ 
cita~~ 
==~~ 
null~~ 
)~~ 
{ 
return
 
NotFound
 
(
  
$str
  5
)
5 6
;
6 7
}
 
var
 !
tieneProcedimientos
 #
=
$ %
await
& +

_dbContext
, 6
.
6 7
Procedimientos
7 E
.
E F
AnyAsync
F N
(
N O
p
O P
=>
Q S
p
T U
.
U V
IdCita
V \
==
] _
id
` b
)
b c
;
c d
if
 
(
 !
tieneProcedimientos
 #
)
# $
{
 
return
 

BadRequest
 !
(
! "
$str
" h
)
h i
;
i j
}
 

_dbContext
 
.
 
Citas
 
.
 
Remove
 #
(
# $
cita
$ (
)
( )
;
) *
await
 

_dbContext
 
.
 
SaveChangesAsync
 -
(
- .
)
. /
;
/ 0
return
 
Ok
 
(
 
$"
 
$str
 $
{
$ %
id
% '
}
' (
$str
( A
"
A B
)
B C
;
C D
}
 	
private
 
bool
 

CitaExists
 
(
  
int
  #
id
$ &
)
& '
{
 	
return
 

_dbContext
 
.
 
Citas
 #
.
# $
Any
$ '
(
' (
e
( )
=>
* ,
e
- .
.
. /
IdCita
/ 5
==
6 8
id
9 ;
)
; <
;
< =
}
 	
}
 
public
 

class
 
CreateCitaDto
 
{
 
[
 	
Required
	 
(
 
ErrorMessage
 
=
  
$str
! F
)
F G
]
G H
[
 	
DataType
	 
(
 
DataType
 
.
 
Date
 
,
  
ErrorMessage
! -
=
. /
$str
0 e
)
e f
]
f g
[
 	
Range
	 
(
 
typeof
 
(
 
DateTime
 
)
 
,
  
$str
! -
,
- .
$str
/ ;
,
; <
ErrorMessage
= I
=
J K
$str
L w
)
w x
]
x y
public
 
DateTime
 
Fecha
 
{
 
get
  #
;
# $
set
% (
;
( )
}
* +
[
 	
Required
	 
(
 
ErrorMessage
 
=
  
$str
! E
)
E F
]
F G
[
 	
RegularExpression
	 
(
 
$str
 @
,
@ A
ErrorMessage
B N
=
O P
$strQ 
) 
] 
public
 
string
 
?
 
Hora
 
{
 
get
 !
;
! "
set
# &
;
& '
}
( )
[
 	
Required
	 
(
 
ErrorMessage
 
=
  
$str
! <
)
< =
]
= >
[
   	
StringLength
  	 
(
   
$num
   
,
   
ErrorMessage
   '
=
  ( )
$str
  * Z
)
  Z [
]
  [ \
[
¡¡ 	
RegularExpression
¡¡	 
(
¡¡ 
$str
¡¡ 2
,
¡¡2 3
ErrorMessage
¡¡4 @
=
¡¡A B
$str¡¡C 
)¡¡ 
]¡¡ 
public
¢¢ 
string
¢¢ 
?
¢¢ 
Motivo
¢¢ 
{
¢¢ 
get
¢¢  #
;
¢¢# $
set
¢¢% (
;
¢¢( )
}
¢¢* +
[
¤¤ 	
Required
¤¤	 
(
¤¤ 
ErrorMessage
¤¤ 
=
¤¤  
$str
¤¤! E
)
¤¤E F
]
¤¤F G
[
¥¥ 	
Range
¥¥	 
(
¥¥ 
$num
¥¥ 
,
¥¥ 
int
¥¥ 
.
¥¥ 
MaxValue
¥¥ 
,
¥¥ 
ErrorMessage
¥¥  ,
=
¥¥- .
$str
¥¥/ `
)
¥¥` a
]
¥¥a b
public
¦¦ 
int
¦¦ 

IdPaciente
¦¦ 
{
¦¦ 
get
¦¦  #
;
¦¦# $
set
¦¦% (
;
¦¦( )
}
¦¦* +
[
¨¨ 	
Required
¨¨	 
(
¨¨ 
ErrorMessage
¨¨ 
=
¨¨  
$str
¨¨! C
)
¨¨C D
]
¨¨D E
[
©© 	
Range
©©	 
(
©© 
$num
©© 
,
©© 
int
©© 
.
©© 
MaxValue
©© 
,
©© 
ErrorMessage
©©  ,
=
©©- .
$str
©©/ ^
)
©©^ _
]
©©_ `
public
ªª 
int
ªª 
IdDoctor
ªª 
{
ªª 
get
ªª !
;
ªª! "
set
ªª# &
;
ªª& '
}
ªª( )
}
«« 
public
­­ 

class
­­ 
UpdateCitaDto
­­ 
{
®® 
[
¯¯ 	
DataType
¯¯	 
(
¯¯ 
DataType
¯¯ 
.
¯¯ 
Date
¯¯ 
,
¯¯  
ErrorMessage
¯¯! -
=
¯¯. /
$str
¯¯0 e
)
¯¯e f
]
¯¯f g
[
°° 	
Range
°°	 
(
°° 
typeof
°° 
(
°° 
DateTime
°° 
)
°° 
,
°°  
$str
°°! -
,
°°- .
$str
°°/ ;
,
°°; <
ErrorMessage
°°= I
=
°°J K
$str
°°L w
)
°°w x
]
°°x y
public
±± 
DateTime
±± 
?
±± 
Fecha
±± 
{
±±  
get
±±! $
;
±±$ %
set
±±& )
;
±±) *
}
±±+ ,
[
³³ 	
RegularExpression
³³	 
(
³³ 
$str
³³ @
,
³³@ A
ErrorMessage
³³B N
=
³³O P
$str³³Q 
)³³ 
]³³ 
public
´´ 
string
´´ 
?
´´ 
Hora
´´ 
{
´´ 
get
´´ !
;
´´! "
set
´´# &
;
´´& '
}
´´( )
[
¶¶ 	
StringLength
¶¶	 
(
¶¶ 
$num
¶¶ 
,
¶¶ 
ErrorMessage
¶¶ '
=
¶¶( )
$str
¶¶* Z
)
¶¶Z [
]
¶¶[ \
[
·· 	
RegularExpression
··	 
(
·· 
$str
·· 2
,
··2 3
ErrorMessage
··4 @
=
··A B
$str··C 
)·· 
]·· 
public
¸¸ 
string
¸¸ 
?
¸¸ 
Motivo
¸¸ 
{
¸¸ 
get
¸¸  #
;
¸¸# $
set
¸¸% (
;
¸¸( )
}
¸¸* +
[
ºº 	
Range
ºº	 
(
ºº 
$num
ºº 
,
ºº 
int
ºº 
.
ºº 
MaxValue
ºº 
,
ºº 
ErrorMessage
ºº  ,
=
ºº- .
$str
ºº/ `
)
ºº` a
]
ººa b
public
»» 
int
»» 
?
»» 

IdPaciente
»» 
{
»»  
get
»»! $
;
»»$ %
set
»»& )
;
»») *
}
»»+ ,
[
½½ 	
Range
½½	 
(
½½ 
$num
½½ 
,
½½ 
int
½½ 
.
½½ 
MaxValue
½½ 
,
½½ 
ErrorMessage
½½  ,
=
½½- .
$str
½½/ ^
)
½½^ _
]
½½_ `
public
¾¾ 
int
¾¾ 
?
¾¾ 
IdDoctor
¾¾ 
{
¾¾ 
get
¾¾ "
;
¾¾" #
set
¾¾$ '
;
¾¾' (
}
¾¾) *
}
¿¿ 
}ÀÀ ûL
SC:\Users\nahir\source\repos\GestionCitasMedicas\GestionCitasMedicas\AppDBContext.cs
	namespace 	
GestionCitasMedicas
 
{ 
public 

class 
AppDBContext 
: 
	DbContext  )
{ 
	protected 
AppDBContext 
( 
)  
{! "
}# $
public

 
AppDBContext

 
(

 
DbContextOptions

 ,
<

, -
AppDBContext

- 9
>

9 :
options

; B
)

B C
:

D E
base

F J
(

J K
options

K R
)

R S
{ 	
} 	
public 
DbSet 
< 
Paciente 
> 
	Pacientes (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DbSet 
< 
Doctor 
> 
Doctores %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
DbSet 
< 
Cita 
> 
Citas  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
Procedimiento "
>" #
Procedimientos$ 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
Cita  $
>$ %
(% &
)& '
. 
HasOne 
< 
Paciente  
>  !
(! "
)" #
. 
WithMany 
( 
) 
. 
HasForeignKey 
( 
c  
=>! #
c$ %
.% &

IdPaciente& 0
)0 1
. 
OnDelete 
( 
DeleteBehavior (
.( )
Cascade) 0
)0 1
;1 2
modelBuilder 
. 
Entity 
<  
Cita  $
>$ %
(% &
)& '
. 
HasOne 
< 
Doctor 
> 
(  
)  !
. 
WithMany 
( 
) 
.   
HasForeignKey   
(   
c    
=>  ! #
c  $ %
.  % &
IdDoctor  & .
)  . /
.!! 
OnDelete!! 
(!! 
DeleteBehavior!! (
.!!( )
Cascade!!) 0
)!!0 1
;!!1 2
modelBuilder$$ 
.$$ 
Entity$$ 
<$$  
Procedimiento$$  -
>$$- .
($$. /
)$$/ 0
.%% 
HasOne%% 
<%% 
Cita%% 
>%% 
(%% 
)%% 
.&& 
WithMany&& 
(&& 
)&& 
.'' 
HasForeignKey'' 
('' 
p''  
=>''! #
p''$ %
.''% &
IdCita''& ,
)'', -
.(( 
OnDelete(( 
((( 
DeleteBehavior(( (
.((( )
Cascade(() 0
)((0 1
;((1 2
modelBuilder** 
.** 
Entity** 
<**  
Procedimiento**  -
>**- .
(**. /
)**/ 0
.++ 
Property++ 
(++ 
p++ 
=>++ 
p++  
.++  !
Costo++! &
)++& '
.,, 
HasColumnType,, 
(,, 
$str,, .
),,. /
;,,/ 0
modelBuilder.. 
... 
Entity.. 
<..  
Paciente..  (
>..( )
(..) *
)..* +
.// 
Property// 
(// 
p// 
=>// 
p//  
.//  !

IdPaciente//! +
)//+ ,
.00 
ValueGeneratedOnAdd00 $
(00$ %
)00% &
;00& '
modelBuilder22 
.22 
Entity22 
<22  
Doctor22  &
>22& '
(22' (
)22( )
.33 
Property33 
(33 
d33 
=>33 
d33  
.33  !
IdDoctor33! )
)33) *
.44 
ValueGeneratedOnAdd44 $
(44$ %
)44% &
;44& '
modelBuilder66 
.66 
Entity66 
<66  
Cita66  $
>66$ %
(66% &
)66& '
.77 
Property77 
(77 
c77 
=>77 
c77  
.77  !
IdCita77! '
)77' (
.88 
ValueGeneratedOnAdd88 $
(88$ %
)88% &
;88& '
modelBuilder:: 
.:: 
Entity:: 
<::  
Procedimiento::  -
>::- .
(::. /
)::/ 0
.;; 
Property;; 
(;; 
p;; 
=>;; 
p;;  
.;;  !
IdProcedimiento;;! 0
);;0 1
.<< 
ValueGeneratedOnAdd<< $
(<<$ %
)<<% &
;<<& '
}== 	
}>> 
public@@ 

class@@ 
Paciente@@ 
{AA 
[BB 	
KeyBB	 
]BB 
publicCC 
intCC 

IdPacienteCC 
{CC 
getCC  #
;CC# $
setCC% (
;CC( )
}CC* +
publicEE 
requiredEE 
stringEE 
NombreEE %
{EE& '
getEE( +
;EE+ ,
setEE- 0
;EE0 1
}EE2 3
publicFF 
requiredFF 
DateTimeFF  
FechaNacimientoFF! 0
{FF1 2
getFF3 6
;FF6 7
setFF8 ;
;FF; <
}FF= >
publicGG 
requiredGG 
stringGG 
?GG 
TelefonoGG  (
{GG) *
getGG+ .
;GG. /
setGG0 3
;GG3 4
}GG5 6
publicHH 
requiredHH 
stringHH 
?HH 
	DireccionHH  )
{HH* +
getHH, /
;HH/ 0
setHH1 4
;HH4 5
}HH6 7
}II 
publicKK 

classKK 
DoctorKK 
{LL 
[MM 	
KeyMM	 
]MM 
publicNN 
intNN 
IdDoctorNN 
{NN 
getNN !
;NN! "
setNN# &
;NN& '
}NN( )
publicPP 
requiredPP 
stringPP 
NombrePP %
{PP& '
getPP( +
;PP+ ,
setPP- 0
;PP0 1
}PP2 3
publicQQ 
requiredQQ 
stringQQ 
EspecialidadQQ +
{QQ, -
getQQ. 1
;QQ1 2
setQQ3 6
;QQ6 7
}QQ8 9
publicRR 
requiredRR 
stringRR 
?RR 
TelefonoRR  (
{RR) *
getRR+ .
;RR. /
setRR0 3
;RR3 4
}RR5 6
publicSS 
requiredSS 
stringSS 
?SS 
EmailSS  %
{SS& '
getSS( +
;SS+ ,
setSS- 0
;SS0 1
}SS2 3
publicTT 
requiredTT 
stringTT 
?TT 
SubespecialidadTT  /
{TT0 1
getTT2 5
;TT5 6
setTT7 :
;TT: ;
}TT< =
}UU 
publicWW 

classWW 
CitaWW 
{XX 
[YY 	
KeyYY	 
]YY 
publicZZ 
intZZ 
IdCitaZZ 
{ZZ 
getZZ 
;ZZ  
setZZ! $
;ZZ$ %
}ZZ& '
public\\ 
required\\ 
DateTime\\  
Fecha\\! &
{\\' (
get\\) ,
;\\, -
set\\. 1
;\\1 2
}\\3 4
public]] 
required]] 
TimeSpan]]  
Hora]]! %
{]]& '
get]]( +
;]]+ ,
set]]- 0
;]]0 1
}]]2 3
public^^ 
required^^ 
string^^ 
?^^ 
Motivo^^  &
{^^' (
get^^) ,
;^^, -
set^^. 1
;^^1 2
}^^3 4
public`` 
required`` 
int`` 

IdPaciente`` &
{``' (
get``) ,
;``, -
set``. 1
;``1 2
}``3 4
publicaa 
requiredaa 
intaa 
IdDoctoraa $
{aa% &
getaa' *
;aa* +
setaa, /
;aa/ 0
}aa1 2
}bb 
publicdd 

classdd 
Procedimientodd 
{ee 
[ff 	
Keyff	 
]ff 
publicgg 
intgg 
IdProcedimientogg "
{gg# $
getgg% (
;gg( )
setgg* -
;gg- .
}gg/ 0
publicii 
requiredii 
stringii 
Descripcionii *
{ii+ ,
getii- 0
;ii0 1
setii2 5
;ii5 6
}ii7 8
publickk 
requiredkk 
decimalkk 
Costokk  %
{kk& '
getkk( +
;kk+ ,
setkk- 0
;kk0 1
}kk2 3
publicmm 
requiredmm 
intmm 
IdCitamm "
{mm# $
getmm% (
;mm( )
setmm* -
;mm- .
}mm/ 0
}nn 
}oo 